{
    "key": "shopify/product/set_product_metafield_with_price_metaobject",
    "name": "Display price history on a product detail page",
    "version": "1.0.0",
    "enabled": false,
    "setup": false,
    "config": {
        "inputs": [
            {
                "schema": 3,
                "trigger_type": "input",
                "type": "shopify",
                "entity": "product",
                "action": "updated",
                "name": "Product Updated",
                "key": "shopify",
                "operation_id": "products_update",
                "metadata": {
                    "frequency": "every"
                },
                "local_fields": [],
                "selected_fields": [
                    "frequency"
                ],
                "on_error": "default",
                "weight": 0
            }
        ],
        "outputs": [
            {
                "schema": 4,
                "trigger_type": "output",
                "type": "data",
                "entity": "record",
                "action": "query",
                "name": "Query",
                "key": "data",
                "operation_id": "get_database_table",
                "metadata": {
                    "api_endpoint": "get \/{database}\/{table}",
                    "table": "Product Prices",
                    "where_clause": {
                        "comparison": "equals",
                        "b": "{{shopify.id}}",
                        "a": "id"
                    }
                },
                "local_fields": [],
                "selected_fields": [
                    "table",
                    "where_clause",
                    "where_clause.a",
                    "where_clause.comparison",
                    "where_clause.b"
                ],
                "on_error": "default",
                "weight": 0
            },
            {
                "schema": 3,
                "trigger_type": "output",
                "type": "shopify",
                "entity": "product",
                "action": "metafield_get",
                "name": "Retrieve Product Metafield",
                "key": "shopify_1",
                "operation_id": "get_mesa_products_product_id_metafield",
                "metadata": {
                    "api_endpoint": "get mesa\/products\/{{product_id}}\/metafield.json",
                    "product_id": "{{shopify.id}}",
                    "body": {
                        "namespace": "custom",
                        "key": "price_history"
                    }
                },
                "local_fields": [],
                "selected_fields": [
                    "product_id",
                    "body",
                    "body.namespace",
                    "body.key"
                ],
                "on_error": "default",
                "weight": 1
            },
            {
                "schema": 4,
                "trigger_type": "output",
                "type": "data",
                "entity": "record",
                "action": "update_create",
                "name": "Update or Create Record",
                "key": "data_1",
                "operation_id": "post_database_table_upsert",
                "metadata": {
                    "api_endpoint": "post \/{database}\/{table}\/upsert",
                    "create": "existing",
                    "columns": [
                        {
                            "key": "id",
                            "type": "numeric",
                            "value": "{{shopify.id}}",
                            "disabled": "667af4f3345a1742200b4343"
                        },
                        {
                            "key": "price",
                            "type": "numeric",
                            "value": "{{shopify.variants[0].price}}",
                            "disabled": "667af4f3345a1742200b4343"
                        }
                    ],
                    "table": "Product Prices",
                    "where_clause": {
                        "comparison": "equals",
                        "b": "{{shopify.id}}",
                        "a": "id"
                    }
                },
                "local_fields": [],
                "selected_fields": [
                    "create",
                    "table",
                    "where_clause",
                    "where_clause.a",
                    "where_clause.comparison",
                    "where_clause.b",
                    "columns",
                    "columns[].key",
                    "columns[].type",
                    "columns[].value",
                    "columns[].disabled"
                ],
                "on_error": "default",
                "weight": 2
            },
            {
                "schema": 3,
                "trigger_type": "output",
                "type": "shopify",
                "entity": "metaobjects",
                "action": "create",
                "name": "Create Metaobject",
                "key": "shopify_2",
                "operation_id": "post_metaobjects_create",
                "metadata": {
                    "api_endpoint": "post mesa\/metaobjects\/{type}.json",
                    "type": "price_point_in_time",
                    "body": {
                        "fields": {
                            "date": "{{\"now\" | date: \"%Y-%m-%d\"}}",
                            "price": {
                                "amount": "{{shopify.variants[0].price}}",
                                "currency_code": "USD"
                            }
                        }
                    },
                    "publishable_status": "ACTIVE"
                },
                "local_fields": [
                    {
                        "key": "body",
                        "type": "object",
                        "fields": [
                            {
                                "key": "fields",
                                "type": "object",
                                "fields": [
                                    {
                                        "key": "date",
                                        "label": "date",
                                        "type": "text",
                                        "source": "shopify",
                                        "required": false,
                                        "description": "Value must be in \u201cYYYY-MM-DD\u201d format. For example: 2024-05-24",
                                        "example": "2024-05-24",
                                        "location": "required"
                                    },
                                    {
                                        "key": "price",
                                        "label": "price",
                                        "type": "object",
                                        "source": "shopify",
                                        "required": false,
                                        "description": "",
                                        "fields": [
                                            {
                                                "key": "amount",
                                                "label": "Money Value",
                                                "type": "text",
                                                "example": "100.00",
                                                "description": "A numeric value for the money.",
                                                "location": "required"
                                            },
                                            {
                                                "key": "currency_code",
                                                "label": "Currency Code",
                                                "type": "text",
                                                "example": "USD",
                                                "description": "Currency Code is a three-letter code that represents the currency in which the money value is denominated. For example: USD, EUR, GBP.",
                                                "location": "required"
                                            }
                                        ],
                                        "location": "required"
                                    }
                                ],
                                "location": "required"
                            }
                        ],
                        "location": "required"
                    }
                ],
                "selected_fields": [
                    "type"
                ],
                "on_error": "default",
                "weight": 3
            },
            {
                "schema": 2,
                "trigger_type": "output",
                "type": "custom",
                "name": "Add Price Point To Beginning Of Price History",
                "key": "custom",
                "operation_id": "custom",
                "metadata": {
                    "script": "custom.js"
                },
                "local_fields": [],
                "selected_fields": [],
                "on_error": "default",
                "weight": 4
            },
            {
                "schema": 2,
                "trigger_type": "output",
                "type": "custom",
                "name": "Set Product Metafield",
                "key": "custom_1",
                "operation_id": "custom",
                "metadata": {
                    "script": "custom_1.js"
                },
                "local_fields": [],
                "selected_fields": [],
                "on_error": "default",
                "weight": 5
            }
        ]
    }
}