{
  "key": "shoppad/mesa-templates/shopify/order/flag-order-risk-if-no-price",
  "name": "Flag Order as Risky if Total Price is 0",
  "version": "1.0.0",
  "description": "If a new Order has a total price of 0, create a new \"Order Risk\"",
  "video": "",
  "tags": [],
  "source": "shopify_webhook",
  "destination": "filter",
  "enabled": true,
  "config": {
    "inputs": [
      {
        "trigger_type": "input",
        "type": "shopify_webhook",
        "entity": "order",
        "action": "create",
        "name": "Shopify: Order Created",
        "key": "shopify-order-created",
        "metadata": {
          "topic": "orders/create"
        }
      }
    ],
    "outputs": [
      {
        "trigger_type": "output",
        "type": "filter",
        "name": "Filter",
        "key": "filter",
        "metadata": {
          "script": "filter.js",
          "comparison": "less than",
          "a": "{{source.total_price}}",
          "b": "0.01"
        },
        "description": "Mesa Filters allow you to stop the automation if one of the incoming values does not match what is expected. [Read more](https://docs.getmesa.com/article/760-mesa-filter).",
        "destination_entity": "mapping"
      },
      {
        "trigger_type": "output",
        "type": "transform",
        "entity": "mapping",
        "name": "Transform:  Order to Order Risk",
        "key": "transform-mapping",
        "metadata": {
          "script": "transform-order.js",
          "mapping": [
            {
              "destination": "message",
              "source": "This order has a total price of 0"
            },
            {
              "destination": "recommendation",
              "source": "cancel"
            },
            {
              "destination": "score",
              "source": "1.0"
            },
            {
              "destination": "display",
              "source": "true"
            },
            {
              "destination": "source",
              "source": "External"
            }
          ]
        },
        "local_fields": [
          {
            "key": "mapping",
            "type": "mapping"
          }
        ],
        "description": "Mesa Transforms can manipulate the values received into any format required by the next step. [Read more](https://docs.getmesa.com/article/762-mesa-transform)."
      },
      {
        "trigger_type": "output",
        "type": "shopify_api",
        "entity": "order_risk",
        "action": "create",
        "name": "Shopify: Create Order Risk",
        "key": "shopify-create-order-risk",
        "metadata": {
          "shopify_api": "POST admin/orders/{{order_id}}/risks.json",
          "order_id": "{{source.id}}",
          "site": "current"
        },
        "source_entity": "mapping"
      }
    ],
    "storage": []
  }
}
