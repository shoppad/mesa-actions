{
  "key": "shoppad/mesa-templates/shopify/order/send-to-salesforce-opportunity",
  "name": "Send Order To Salesforce Opportunity and Opportunity Products",
  "version": "1.0.0",
  "description": "Send Order from Shopify to Salesforce Opportunity Products when order is created. Also creates / updates any dependent products or accounts in Salesforce",
  "tags": [
    "Order"
  ],
  "source": "shopify",
  "destination": "salesforce",
  "enabled": false,
  "config": {
    "inputs": [
      {
        "trigger_type": "input",
        "type": "shopify_webhook",
        "entity": "order",
        "action": "create",
        "name": "Shopify: Order Created",
        "key": "shopify-order-created",
        "metadata": {
          "topic": "orders/create"
        }
      }
    ],

    /* Outputs: 
    
    1. Check Shopify customer linked in Salesforce (account exists, use external ID field for customer)
    2. Create / update Shopify customer if linked
    3. Check all line items, are products linked in Salesforce? Do a bulk query)
    4. Create / update products in Salesforce
    5. Map order to opp, and line items opp products
    6. Save to Salesforce
    */
    

    "outputs": [
      {
        "trigger_type": "output",
        "type": "transform",
        "entity": "mapping",
        "name": "Mapping to Salesforce Create Opportunity",
        "key": "mapping-to-salesforce-create-Opportunity",
        "metadata": {
          "mapping": [
            {
              "source": "Shopify Order {{source.name}}",
              "destination": "Name"
            },
            {
              "source": "Closed Won",
              "destination": "StageName"
            },
            {
              "source": "Order status: {{source.order_status_url}}",
              "destination": "Description"
            },
            {
              "source": "{{source.total_price}}",
              "destination": "Amount"
            },
            {
              "source": "{{source.created_at}}",
              "destination": "CloseDate"
            }
          ],
          "script": "transform.js"
        },
        "local_fields": [
          {
            "key": "mapping",
            "type": "mapping"
          }
        ],
        "destination_entity": "opportunity"
      },
      {
        "trigger_type": "output",
        "type": "salesforce",
        "entity": "opportunity",
        "action": "create",
        "name": "Salesforce: Create Opportunity",
        "key": "salesforce-create-opportunity",
        "metadata": {
          "entity_name": "Opportunity",
          "method": "POST"
        },
        "source_entity": "mapping"
      }
    ],
    "storage": []
  }
}