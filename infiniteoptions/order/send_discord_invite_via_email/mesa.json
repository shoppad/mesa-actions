{
  "key": "infiniteoptions/order/send_discord_invite_via_email",
  "name": "Send a Discord invitation to a customer when they purchase a tagged product using Infinite Options",
  "version": "1.0.0",
  "description": "This template will be triggered when an Infinite Option Orders comes in with a line item property called \"discord\". If the user has not received a Discord invitation before the Mesa workflow, it will create a new invitation and send the discord invite via email, and it will tag a customer with a tag.\n\nThis template is great for merchants trying to build a community in Discord using Shopify.",
  "video": "",
  "readme": "",
  "tags": [],
  "source": "",
  "destination": "",
  "seconds": 0,
  "enabled": false,
  "logging": false,
  "debug": false,
  "config": {
    "inputs": [
      {
        "schema": 4,
        "trigger_type": "input",
        "type": "infiniteoptions",
        "entity": "order",
        "action": "created",
        "name": "Infinite Options Order Created",
        "key": "infiniteoptions_order",
        "metadata": {
          "field_name": "discord"
        },
        "local_fields": [],
        "weight": 0
      }
    ],
    "outputs": [
      {
        "schema": 3,
        "trigger_type": "output",
        "type": "shopify_api",
        "entity": "customer",
        "action": "retrieve",
        "name": "Shopify Retrieve Customer",
        "key": "shopify_customer",
        "metadata": {
          "customer_id": "{{infiniteoptions_order.order.customer.id}}"
        },
        "local_fields": [],
        "weight": 0
      },
      {
        "schema": 2,
        "trigger_type": "output",
        "type": "filter",
        "name": "Filter",
        "key": "filter",
        "metadata": {
          "a": "discord:invite",
          "comparison": "not in",
          "b": "{{shopify_customer.tags}}"
        },
        "local_fields": [],
        "weight": 1
      },
      {
        "schema": 4,
        "trigger_type": "output",
        "type": "discord",
        "entity": "channel_invite",
        "action": "create",
        "name": "Discord Create Channel Invite",
        "key": "discord_channel_invite",
        "metadata": {
          "path": {
            "channelId": ""
          }
        },
        "local_fields": [],
        "weight": 2
      },
      {
        "schema": 3,
        "trigger_type": "output",
        "type": "shopify_api",
        "entity": "shop",
        "action": "list",
        "name": "Shopify List Shop",
        "key": "shopify_shop",
        "metadata": [],
        "weight": 3
      },
      {
        "schema": 2,
        "trigger_type": "output",
        "type": "email",
        "name": "Email",
        "key": "email",
        "metadata": {
          "to": "{{infiniteoptions_order.order.email}}",
          "subject": "Welcome to our Discord community! - Discord Invite",
          "message": "Hey {{infiniteoptions_order.order.customer.first_name}},\n\nHere is your discord invite https://discord.gg/{{discord_channel_invite.code}}\n\nThanks\n\n"
        },
        "local_fields": [],
        "weight": 4
      },
      {
        "schema": 3,
        "trigger_type": "output",
        "type": "shopify_api",
        "entity": "customer",
        "action": "update",
        "name": "Shopify Update Customer",
        "key": "shopify_customer_1",
        "metadata": {
          "customer_id": "{{shopify_customer.id}}",
          "body": {
            "tags": "{{shopify_customer.tags}}, discord:invite"
          }
        },
        "local_fields": [],
        "weight": 5
      }
    ],
    "storage": []
  }
}
